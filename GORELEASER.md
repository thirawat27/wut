# GoReleaser Setup for WUT

This document explains how GoReleaser is configured for the WUT project to enable multiple installation methods.

## Overview

[GoReleaser](https://goreleaser.com/) is a release automation tool for Go projects. It handles:

- Building binaries for multiple platforms
- Creating GitHub releases with changelogs
- Generating and publishing to package managers
- Building and pushing Docker images
- Generating SBOMs (Software Bill of Materials)
- Code signing

## Installation Methods Added

### 1. **Homebrew** (macOS/Linux)
```bash
brew tap thirawat27/wut
brew install wut
```
- Repository: `thirawat27/homebrew-wut`
- Formula auto-generated on each release

### 2. **WinGet** (Windows)
```powershell
winget install thirawat27.wut
```
- Published to Windows Package Manager Community Repository
- Automated via GitHub Actions

### 3. **Scoop** (Windows)
```powershell
scoop bucket add wut https://github.com/thirawat27/scoop-wut
scoop install wut
```
- Repository: `thirawat27/scoop-wut`
- Manifest auto-generated on each release

### 4. **Chocolatey** (Windows)
```powershell
choco install wut
```
- Published to Chocolatey Community Repository
- Requires `CHOCOLATEY_API_KEY` secret

### 5. **Docker**
```bash
docker pull ghcr.io/thirawat27/wut:latest
docker run --rm ghcr.io/thirawat27/wut:latest suggest
```
- Multi-arch images (amd64, arm64)
- Published to GitHub Container Registry

### 6. **GitHub Releases**
Download pre-built binaries from the [releases page](https://github.com/thirawat27/wut/releases).

## Configuration Files

### Main Configuration
- `.goreleaser.yaml` - Main GoReleaser configuration
- `.github/workflows/release.yml` - GitHub Actions workflow

### Supporting Files
- `.goreleaser.dockerfile` - Optimized Dockerfile for GoReleaser builds
- `homebrew-tap/README.md` - Homebrew tap documentation
- `scoop-bucket/README.md` - Scoop bucket documentation
- `chocolatey/README.md` - Chocolatey package documentation

## Required Secrets

Set these secrets in your GitHub repository settings:

| Secret | Description | Required For |
|--------|-------------|--------------|
| `GITHUB_TOKEN` | Auto-generated by GitHub | GitHub Releases, Docker |
| `HOMEBREW_TAP_GITHUB_TOKEN` | Token for homebrew-wut repo | Homebrew tap updates |
| `SCOOP_BUCKET_GITHUB_TOKEN` | Token for scoop-wut repo | Scoop bucket updates |
| `CHOCOLATEY_API_KEY` | API key for chocolatey.org | Chocolatey publishing |
| `WINGET_TOKEN` | Token for winget-pkgs repo | WinGet publishing |
| `GPG_FINGERPRINT` | GPG key fingerprint | Release signing |

## Usage

### Local Testing

Test the release configuration locally:

```bash
# Check configuration
make goreleaser-check

# Build snapshot (no release)
make goreleaser-snapshot

# Test release process (skip publish)
make goreleaser-release-skip-publish
```

### Creating a Release

1. **Tag the release:**
   ```bash
   git tag -a v1.0.0 -m "Release v1.0.0"
   git push origin v1.0.0
   ```

2. **GitHub Actions automatically:**
   - Runs tests
   - Builds binaries for all platforms
   - Creates GitHub release with changelog
   - Publishes to Homebrew, Scoop, Chocolatey
   - Builds and pushes Docker images
   - Publishes to WinGet (optional)

3. **Or manually trigger:**
   Go to GitHub Actions ‚Üí Release ‚Üí Run workflow

### Platforms Supported

| Platform | Architectures |
|----------|--------------|
| Linux | amd64, arm64, arm, 386, riscv64 |
| macOS | amd64, arm64 (Apple Silicon) |
| Windows | amd64, arm64, 386 |
| FreeBSD | amd64, arm64 |
| OpenBSD | amd64 |
| NetBSD | amd64 |

## Changelog Format

GoReleaser generates changelogs from conventional commits:

| Prefix | Category |
|--------|----------|
| `feat:` | üöÄ Features |
| `fix:` | üêõ Bug Fixes |
| `chore:` / `refactor:` / `perf:` | üßπ Maintenance |
| `docs:` | üìö Documentation |
| `test:` | üî¨ Testing |
| `ci:` | ‚öôÔ∏è CI/CD |

Example:
```bash
git commit -m "feat: add new command suggestion engine"
git commit -m "fix: correct typo handling in suggest command"
git commit -m "docs: update installation instructions"
```

## Troubleshooting

### GoReleaser not installed
```bash
# macOS/Linux
curl -sfL https://goreleaser.com/static/run | bash

# Or use go install
go install github.com/goreleaser/goreleaser/v2@latest
```

### Docker login issues
Ensure `GITHUB_TOKEN` has `packages:write` permission.

### Homebrew/Scoop push fails
Ensure the tokens have `repo` scope and access to the respective repositories.

### Chocolatey push fails
1. Create account at [chocolatey.org](https://chocolatey.org/)
2. Get API key from [account settings](https://community.chocolatey.org/account)
3. Add `CHOCOLATEY_API_KEY` to GitHub secrets

## Resources

- [GoReleaser Documentation](https://goreleaser.com/)
- [GitHub Actions Documentation](https://docs.github.com/en/actions)
- [Homebrew Formula Cookbook](https://docs.brew.sh/Formula-Cookbook)
- [Scoop Wiki](https://github.com/ScoopInstaller/Scoop/wiki)
- [Chocolatey Packaging](https://docs.chocolatey.org/en-us/create/create-packages)
- [WinGet Packages](https://github.com/microsoft/winget-pkgs)
